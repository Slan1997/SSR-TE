# SSR-TE
Sample codes for the manuscript "Adaptive Sample Size Calculations for Rare Disease Clinical Trials Using a Totality of Evidence Approach"

## ABSTRACT
Clinical trial design for rare disease can be challenging due to limited data, heterogeneous clinical manifestations and progression, and often lack of adequate knowledge about the disease. Multiple endpoints are usually used to collectively assess the effectiveness of the investigational drug on multiple aspects of the disease. Here we propose an adaptive design allowing for sample size re-estimation (SSR) based on interim data for a clinical trial with multiple continuous endpoints. The proposed SSR procedure incorporates two existing methods for characterizing the totality of evidence across endpoints: the ordinary least squares (OLS) test and the non-parametric permutation test. Simulation results show that our adaptive design achieves reasonable type I error control and satisfactory power. Compared with the permutation test, the OLS test has improved type I error control when the sample size is small; while the permutation test achieves slightly higher power in most scenarios. The SSR method is particularly useful when the initial sample size is underestimated, by properly adjusting the required sample size in an interim stage. However, when the initial sample size is already adequate, executing SSR can lead to further increase of sample size (or cost of trial), demonstrating the need to carefully decide whether or not the sample size should be increased.

## SIMULATION STUDY
We conduct 1 million simulations for the scenarios using the OLS method and 10,000 simulations for the scenarios using the permutation method, with 2,000 permutations in each simulation.

### Type I Error Control
* ./R codes/alpha_OLStest.R: simulation codes to assess the type I error control across scenarios with the exact small sample OLS test (“OLS”)
* ./R codes/alpha_permutation.R: simulation codes to assess the type I error control across scenarios with the permutation test (“Permutation”)

### Power Assessment
* ./R codes/power_OLStest.R: simulation codes to assess the power across scenarios with the exact small sample OLS test (“OLS”)
* ./R codes/power_permutation.R: simulation codes to assess the power control across scenarios with the permutation test (“Permutation”)

### Parallel Computing in the Cluster
All the above R codes for simulation are run in the computing cluster ACCRE (The Advanced Computing Center for Research and Education), following slurm files (in the folder "./slurm for cluster/") are used:
* run_alpha_OLS.slurm: run “alpha_OLStest.R” in 72 separate nodes (array=1-72) for 72 scenarios investigated (Only 30 are reported for “OLS” in the manuscript since we omitted the scenarios with sample size of the control group N_C > 1,000)
* run_alpha_perm.slurm: run “alpha_permutation.R” in 2400 separate nodes (array=1-2400) for 2400 run_idx combined by 48 scenarios and 50 batches of simulations (We distribute 10,000 simulations into 50 batches: 1-200, 201-400,...). See details in “alpha_permutation.R”. Same as above, only 30 scenarios for “Permutation” are reported in the manuscript since we omitted the scenarios with sample size of the control group N_C > 1,000)
* run_power_OLS.slurm: run “power_OLStest.R” in 48 separate nodes (array=1-48) for 48 scenarios investigated
* run_power_perm.slurm: run “power_permutation.R” in 2400 separate nodes (array=1-2400) for 2400 run_idx combined by 48 scenarios and 50 batches of simulations (We distribute 10,000 simulations into 50 batches: 1-200, 201-400,...). See details in “power_permutation.R”

### Combine Results from Parallel Computing
For each node/array, one csv file was created to store the partial results. To combine all the results, “combine_results.R” should be run. There are 4 csv files of the combined results generated by this code, which are already saved in the “./Result datasets/” folder:
* alpha_newdf729.csv: empirical type I error (alpha) with the exact small sample OLS test
* 1e4debug_perm2e3_729.csv: empirical type I error (alpha) with the permutation test
* power_newdf_729.csv: empirical power with the exact small sample OLS test
* power1e4_perm2e3_729.csv: empirical power with the permutation test

## PLOTS and TABLES
The codes for generating Figure 1-3 and Table 1 in the manuscript are: 
* ./R codes/Figure1.R
* ./R codes/Figure2.R
* ./R codes/Figure3.R
* ./R codes/Table1.R

The resulting figures and table are saved in the “./plots_and_tables” folder.








